<!DOCTYPE html>
<html lang="en">

<head>
  <title>Cargomail</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- DataTables -->
  <!-- <script src="https://cdn.datatables.net/1.13.3/js/importmap.js"></script> -->
  <script type="importmap">
    {
      "imports": {
        "datatables.net": "https://cdn.datatables.net/1.13.5/js/jquery.dataTables.mjs",
        "datatables.net-bs5": "https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.mjs",
        "datatables.net-select": "https://cdn.datatables.net/select/1.7.0/js/dataTables.select.min.mjs",
        "datatables.net-select-bs5": "https://cdn.datatables.net/select/1.7.0/js/select.bootstrap5.min.mjs",
        "datatables.net-buttons": "https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.mjs",
        "datatables.net-buttons-bs5": "https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.mjs",
        "datatables.net-responsive": "https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.mjs",
        "datatables.net-responsive-bs5": "https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.mjs",
        "jquery": "https://esm.sh/jquery@3.7.0"
      }
    }
</script>

  <!-- Favicon -->
  <link rel='icon' type='image/x-icon' href='/public/images/favicon.ico'>

  <!-- Icons -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css' />

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" />

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap5.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/select/1.7.0/css/select.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css" />

  <!-- Custom CSS -->
  <link href='/public/css/styles.css' rel='stylesheet'>

  <!-- Bootstrap js-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- jquery for selectize -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

  <!-- selectize -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.15.2/js/selectize.min.js'></script>

  <!-- selectize CSS -->
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.15.2/css/selectize.bootstrap5.min.css" />

  <!-- api.js-->
  <script src='/public/js/api.js'></script>

</head>

<body>
  <div class="container-fluid">
    <div hidden class="base-spinner">
      <div class="spinner-border" role="status">
      </div>
    </div>
    <!-- menu.layout begin -->
    <div style="width: 100%">
      <!-- https://stackoverflow.com/questions/48472771/bootstrap-responsive-sidebar-menu-to-top-navbar/48477019#48477019 -->
      <div class="responsive-menu row vh-100 overflow-auto">
        <div class="col-12 col-sm-3 col-xl-2 px-sm-2 px-0 bg-primary d-flex sticky-top">
          <div class="d-flex flex-sm-column flex-row flex-grow-1 align-items-center align-items-sm-start px-3 pt-1">
            <ul class="nav nav-pills">
              <li class="nav-item">
                <a href="#" id="composeLink" class="nav-link my-0 px-sm-0 px-2">
                  <div class="d-flex d-sm-none d-sm-inline">
                    <i class="bi bi-envelope-plus h2"></i>
                    <span class="ms-2 mt-1 fs-7"><small class="subject-heading"></small></span>
                  </div>
                  <div class="d-none d-sm-inline">
                    <i class="bi bi-envelope-plus h2"></i>
                    <span class="ms-1 fs-5">Compose</span>
                    <br />
                    <span class="fs-7"><small class="subject-heading"></small></span>
                  </div>
                </a>
              </li>
            </ul>
            <ul
              class="nav nav-pills flex-sm-column flex-row flex-nowrap flex-shrink-1 flex-sm-grow-0 flex-grow-1 mb-sm-auto me-2 justify-content-end align-items-center align-items-sm-start"
              id="menu">
              <li class="dropdown" id="messageDropdownMenu">
                <a href="#" class="nav-link dropdown-toggle px-sm-0 px-1" id="messagesLink" data-bs-toggle="dropdown"
                  aria-expanded="false">
                  <i class="bi bi-envelope h4" id="messagesIcon"></i><span
                    class="ms-1 d-none d-sm-inline">Messages</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-light text-small shadow" aria-labelledby="messagesLink">
                  <li class="dropdown-item">
                    <a class="btn px-2" id="inboxLinkSm">
                      <i class="bi bi-envelope h4"></i>
                      <span class="ms-1 d-sm-inline">Inbox</span></a>
                  </li>
                  <li class="dropdown-item">
                    <a class="btn px-2" id="sentLinkSm">
                      <i class="bi bi-envelope-check h4"></i>
                      <span class="ms-1 d-sm-inline">Sent</span></a>
                  </li>
                  <li class="dropdown-item">
                    <a class="btn px-2" id="draftsLinkSm">
                      <i class="bi bi-envelope-slash h4"></i>
                      <span class="ms-1 d-sm-inline">Drafts</span></a>
                  </li>
                </ul>
              </li>

              <div id="messageClassicMenu">
                <li class="nav-item">
                  <a href="#" class="nav-link px-sm-0 px-2" id="inboxLinkLg">
                    <i class="bi bi-envelope h4"></i>
                    <span class="ms-1 d-none d-sm-inline">Inbox</span></a>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link px-sm-0 px-2" id="sentLinkLg">
                    <i class="bi bi-envelope-check h4"></i>
                    <span class="ms-1 d-none d-sm-inline">Sent</span></a>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link px-sm-0 px-2" id="draftsLinkLg">
                    <i class="bi bi-envelope-slash h4"></i>
                    <span class="ms-1 d-none d-sm-inline">Drafts</span></a>
                </li>
              </div>

              <li class="nav-item">
                <a href="#" id="filesLink" class="nav-link px-sm-0 px-2">
                  <i class="bi bi-file-earmark-diff h4"></i>
                  <span class="ms-1 d-none d-sm-inline">Files</span></a>
              </li>
            </ul>
            <div class="dropdown py-sm-4 mt-sm-auto ms-auto ms-sm-0 flex-shrink-1">
              <ul
                class="nav nav-pills flex-sm-column flex-row flex-nowrap flex-shrink-1 flex-sm-grow-0 flex-grow-1 mb-sm-auto me-2 justify-content-end align-items-center align-items-sm-start"
                id="menu">
                <li class="dropdown">
                  <a href="#" class="nav-link d-flex align-items-center text-decoration-none dropdown-toggle"
                    id="userLink" data-bs-toggle="dropdown" aria-expanded="false">
                    <div class="rounded-circle border d-flex justify-content-center align-items-center"
                      id="loggedUsernameLetter" style="width:28px;height:28px" alt="Avatar">
                    </div>
                    <span class="mx-2" id="loggedUsername"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-light text-small shadow" aria-labelledby="userLink">
                    <li class="dropdown-item">
                      <a id="contactsLink" class="btn px-2">
                        <i class="bi bi-people h4"></i>
                        <span class="ms-1 d-sm-inline">Contacts</span></a>
                    </li>
                    <li class="dropdown-item">
                      <a id="profileLink" class="btn px-2">
                        <i class="bi bi-person h4"></i>
                        <span class="ms-1 d-sm-inline">Profile</span></a>
                    </li>
                    <li>
                      <hr class="dropdown-divider">
                    </li>
                    <li class="dropdown-item">
                      <a href="/logout.html" id="logoutLink" class="btn px-sm-0 px-2">
                        <i class="bi bi-box-arrow-right h4"></i>
                        <span class="ms-1 d-sm-inline">Sign out</span></a>
                    </li>
                    <!-- <li><a class="dropdown-item" href="/logout.html">Sign out</a></li> -->
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col d-flex flex-column h-sm-100">
          <main class="row overflow-auto h-100">
            <div class="col pt-4" style="height: 0vh!important; max-height: 0vh!important;">
              <div hidden class="menu-spinner">
                <div class="spinner-border" role="status">
                </div>
              </div>
              <div hidden class="container" id="composeContainer">
                <ui-include src="/snippets/compose.page.html"></ui-include>
              </div>
              <div hidden class="inbox" id="inboxContainer">
                <ui-include src="/snippets/inbox.page.html"></ui-include>
              </div>
              <div hidden class="sent" id="sentContainer">
                <ui-include src="/snippets/sent.page.html"></ui-include>
              </div>
              <div hidden class="drafts" id="draftsContainer">
                <ui-include src="/snippets/drafts.page.html"></ui-include>
              </div>
              <div hidden class="files" id="filesContainer">
                <ui-include src="/snippets/files.page.html"></ui-include>
              </div>
              <div hidden class="contacts" id="contactsContainer">
                <ui-include src="/snippets/contacts.page.html"></ui-include>
              </div>
              <div hidden class="profile" id="profileContainer">
                <ui-include src="/snippets/profile.page.html"></ui-include>
              </div>
            </div>
          </main>
          <footer class="row bg-light py-1 mt-auto">
            <div hidden class="container" id="composePanel">
              <div class="d-flex justify-content-evenly">
                <a class="btn btn-light px-2" id="composePanelNew">
                  <i class="fs-5 bi-file-earmark-plus"></i>
                  <span class="ms-1 d-none d-sm-inline">New</span>
                </a>
                <a class="btn disabled btn-light px-2" id="composePanelSend">
                  <i class="fs-5 bi-send"></i>
                  <span class="ms-1 d-none d-sm-inline">Send</span></a>
                <a class="btn disabled btn-light px-2" id="composePanelDiscard">
                  <i class="fs-5 bi-trash3"></i>
                  <span class="ms-1 d-none d-sm-inline">Discard</span>
                </a>
              </div>
            </div>
            <div hidden class="container" id="inboxPanel">
              <div class="d-flex justify-content-evenly">
                <a class="btn disabled btn-light px-2" id="copySelectedInbox">
                  <i class="fs-5 bi-box-arrow-in-up"></i>
                  <span class="ms-1 d-none d-sm-inline">Copy selected to Compose Form</span>
                </a>
              </div>
            </div>
            <div hidden class="container" id="sentPanel">
              <div class="d-flex justify-content-evenly">
                <a class="btn disabled btn-light px-2" id="copySelectedSent">
                  <i class="fs-5 bi-box-arrow-in-up"></i>
                  <span class="ms-1 d-none d-sm-inline">Copy selected to Compose Form</span>
                </a>
              </div>
            </div>
            <div hidden class="container" id="draftsPanel">
              <div class="d-flex justify-content-evenly">
                <!-- <a class="btn disabled btn-light px-2" id="copySelectedDrafts">
                  <i class="fs-5 bi-box-arrow-in-up"></i>
                  <span class="ms-1 d-none d-sm-inline">Copy selected to Compose Form</span>
                </a> -->
              </div>
            </div>
            <div hidden class="container" id="filesPanel">
              <div class="d-flex justify-content-evenly">
                <a class="btn disabled btn-light px-2" id="copySelectedFiles" role="button" aria-disabled="true">
                  <i class="fs-5 bi-box-arrow-in-up"></i>
                  <span class="ms-1 d-none d-sm-inline">Copy selected to Compose Form</span>
                </a>
              </div>
            </div>
            <div hidden class="container" id="contactsPanel">
            </div>
            <div hidden class="container" id="profilePanel">
            </div>
          </footer>
        </div>
      </div>
    </div>
    <!-- menu.layout end -->
  </div>
</body>

<script src='/public/js/index.js'></script>
<!-- <script src='/public/js/menu.js'></script> -->

<script>
  function modifyMenu(media) {
    if (media.matches) {
      document.getElementById("messageDropdownMenu").hidden = false;
      document.getElementById("messageClassicMenu").hidden = true;
    } else {
      document.getElementById("messageDropdownMenu").hidden = true;
      document.getElementById("messageClassicMenu").hidden = false;
    }
  }

  const media = window.matchMedia("(max-width: 575px)")
  modifyMenu(media)
  media.addListener(modifyMenu)
</script>

<script type="module">
  // menu
  import {
    composeContentPage,
    inboxContentPage,
    sentContentPage,
    draftsContentPage,
    filesContentPage,
    contactsContentPage,
    profileContentPage,
    loadProfile,
  } from "/public/js/menu.js";
  document.querySelector('#composeLink').addEventListener('click', () => composeContentPage(document.querySelector('#composeLink')))
  document.querySelector('#inboxLinkSm').addEventListener('click', () => inboxContentPage(document.querySelector('#inboxLinkSm')))
  document.querySelector('#inboxLinkLg').addEventListener('click', () => inboxContentPage(document.querySelector('#inboxLinkLg')))
  document.querySelector('#sentLinkSm').addEventListener('click', () => sentContentPage(document.querySelector('#sentLinkSm')))
  document.querySelector('#sentLinkLg').addEventListener('click', () => sentContentPage(document.querySelector('#sentLinkLg')))
  document.querySelector('#draftsLinkSm').addEventListener('click', () => draftsContentPage(document.querySelector('#draftsLinkSm')))
  document.querySelector('#draftsLinkLg').addEventListener('click', () => draftsContentPage(document.querySelector('#draftsLinkLg')))
  document.querySelector('#filesLink').addEventListener('click', () => filesContentPage(document.querySelector('#filesLink')))
  document.querySelector('#contactsLink').addEventListener('click', () => contactsContentPage(document.querySelector('#contactsLink')))
  document.querySelector('#profileLink').addEventListener('click', () => profileContentPage(document.querySelector('#profileLink')))

  // compose
  import { idChanged, messageHtmlChanged, messageHtmlOnFocusIn, messageHtmlOnMouseUp, messageHtmlOnKeyUp, removeAttachments, ccToggle, bccToggle, newDraft, sendDraft, discardDraft, deleteDraft } from "/public/js/compose.js";
  document.querySelector('#composeIdInput').addEventListener('change', idChanged);
  document.querySelector('#messageHtml').addEventListener('input', messageHtmlChanged);
  document.querySelector('#messageHtml').addEventListener('focusin', messageHtmlOnFocusIn);
  document.querySelector('#messageHtml').addEventListener('mouseup', messageHtmlOnMouseUp);
  document.querySelector('#messageHtml').addEventListener('keyup', messageHtmlOnKeyUp);
  document.querySelector('#composeRemoveConfirmButton').addEventListener('click', removeAttachments);
  document.querySelector('#composeDiscardConfirmButton').addEventListener('click', deleteDraft);
  document.querySelector('#ccButton').addEventListener('click', ccToggle);
  document.querySelector('#bccButton').addEventListener('click', bccToggle);
  document.querySelector('#composePanelNew').addEventListener('click', newDraft);
  document.querySelector('#composePanelSend').addEventListener('click', sendDraft);
  document.querySelector('#composePanelDiscard').addEventListener('click', discardDraft);

  // inbox
  import { deleteInboxThreads } from "/public/js/inbox.js";
  document.querySelector('#inboxConfirmButton').addEventListener('click', deleteInboxThreads);

  // sent
  import { deleteSentThreads } from "/public/js/sent.js";
  document.querySelector('#sentConfirmButton').addEventListener('click', deleteSentThreads);

  // drafts
  import { deleteDraftsMessages } from "/public/js/drafts.js";
  document.querySelector('#draftsConfirmButton').addEventListener('click', deleteDraftsMessages);

  // message_details
  import { copySelectedFiles as copySelectedFilesFromMessages } from "/public/js/message_detail.js";
  document.querySelector('#copySelectedSent').addEventListener('click', copySelectedFilesFromMessages);
  document.querySelector('#copySelectedInbox').addEventListener('click', copySelectedFilesFromMessages);

  // files
  import { inputUploadChanged, clearUpload, deleteFiles, copySelectedFiles } from "/public/js/files.js";
  document.querySelector('#inputUpload').addEventListener('change', inputUploadChanged)
  document.querySelector('#clearButton').addEventListener('click', clearUpload);
  document.querySelector('#filesConfirmButton').addEventListener('click', deleteFiles);
  document.querySelector('#copySelectedFiles').addEventListener('click', copySelectedFiles);

  // contacts
  import { showContactsFormDialog, submitFormContact, deleteContacts } from "/public/js/contacts.js";
  document.querySelector('#contactsFormDialog').addEventListener('show.bs.modal', showContactsFormDialog)
  document.querySelector("#contactsForm").addEventListener('submit', submitFormContact);
  // document.querySelector('#saveContact').addEventListener('click', saveContact);
  document.querySelector('#contactsConfirmButton').addEventListener('click', deleteContacts);

  // profile 
  import * as profile from "/public/js/profile.js";

  // default page
  const draftsFormAlert = document.getElementById("draftsFormAlert");
  const loggedUsername = await loadProfile(draftsFormAlert);
  draftsContentPage(document.getElementById("draftsLinkSm"));

  // database
  import * as database from "/public/js/database.js";

  if (!database.db) {
    database.openDatabase(loggedUsername);
  }
</script>

</html>